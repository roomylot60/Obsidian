# Prompt Engineering

```python
"""
프롬프트 템플릿 모듈

목적:
- LLM에 전달할 다양한 분석 작업용 프롬프트 템플릿 정의
- 각 작업별로 최적화된 지시문 제공
- 일관된 출력 형식 강제

사용 방법:
- IntentAnalyzer 클래스에서 f-string으로 변수를 삽입하여 사용
- 예: prompt = SUMMARY_PROMPT.format(summary_input=text)

주요 프롬프트 종류:
- 요약 프롬프트: 대화 내용 요약
- 인텐트 분석 프롬프트: 대화 의도 분류
- 감정 분석 프롬프트: 고객 감정 상태 평가
- 엔티티/발화 분석 프롬프트: 주요 개체 및 핵심 발화 추출
"""

# 요약 생성 프롬프트 - 기본 버전
# 역할: 대화 내용을 간결하게 30자 이내로 요약
# 입력: summary_input (요약할 텍스트)
# 출력: 30자 이내의 간결한 요약문
SUMMARY_PROMPT = """
다음 내용을 보고 핵심을 30자 이내로 요약하세요.

{summary_input}

[요구사항]
※ 반드시 30자 이내 1줄로 작성할 것
※ 중요 키워드를 반드시 요약에 포함할 것
※ 중요한 핵심 내용만 작성할 것
※ 부가 설명 없이 요약문만 작성할 것
"""


# 요약 생성 프롬프트 - 키워드 강조 버전
# 역할: 대화 내용을 요약하면서 특정 키워드를 강조
# 입력: summary_input (요약할 텍스트), keywords (강조할 키워드)
# 출력: 키워드를 **로 강조한 30자 이내의 요약문
SUMMARY_WITH_KEYWORDS_PROMPT = """
다음 내용을 보고 핵심을 30자 이내로 요약하세요.

{summary_input}

중요 키워드: {keywords}

[요구사항]
※ 반드시 30자 이내 1줄로 작성할 것
※ 반드시 중요 키워드 앞뒤에 **를 붙여 요약에 포함할 것 예) **키워드**
※ 중요한 핵심 내용만 작성할 것
※ 부가 설명 없이 요약문만 작성할 것
"""



# 고객 메시지 분석 프롬프트 - 기본 버전
# 역할: 고객 발화 내용에서 문제/요청/불만 사항 추출
# 입력: query (고객 발화 텍스트)
# 출력: 고객 문제, 고객 요청, 고객 불만 세 가지 항목으로 구성된 분석 결과
CUSTOMER_PROMPT = """
다음 고객 발화 내용을 분석하여 ** 출력 형식 **에 맞춰 작성하시오.
※ 반드시 각 항목을 30자 이내 1줄로 작성하시오.
※ 반드시 한국어로 작성하시오.
※ 추가적인 설명, 부연 설명, 주석 등을 포함하지 않을 것.
※ 고객이 사용한 발화 단어를 그대로 사용할 것.

** 고객 발화 내용 **: {query}\n\n

** 출력 형식 **\n
고객 문제 : 어떤 일이 어떤 과정을 거쳐 무슨 문제가 발생했는지를 고객이 제공하는 발화 단어를 그대로 기재하여 한 줄로 나타낸다.
고객 요청 : 고객이 요청한 내용들을 각각 기재하되, 의문점에 대한 이유 확인 요청도 포함한다.
고객 불만 : 고객이 불만을 제기한 경우, 불만 내용을 기재한다. (없으면 기재 x)
"""


# 고객 메시지 분석 프롬프트 - 키워드 활용 버전
# 역할: 고객 발화 내용에서 문제/요청/불만 사항 추출 (사전 추출된 키워드 활용)
# 입력: query (고객 발화 텍스트), keywords (발견된 중요 키워드)
# 출력: 고객 문제, 고객 요청, 고객 불만 세 가지 항목으로 구성된 분석 결과 (키워드 강조)
CUSTOMER_PROMPT_WITH_KEYWORDS = """
다음 고객 발화 내용을 분석하여 ** 출력 형식 **에 맞춰 작성하시오.
※ 반드시 각 항목을 30자 이내 1줄로 작성하시오.
※ 반드시 한국어로 작성하시오.
※ 중요: 다음 키워드가 고객 발화 내용에서 발견되었으며, 이를 그대로 분석 내용에 반영하시오: {keywords}

** 고객 발화 내용 **: {query}

** 출력 형식 **
고객 문제 : 고객이 처한 문제 상황을 세부적으로 기재한다.
고객 요청 : 고객이 불만 제기 없이 요청만 한 경우에 대한 요청사항을 기재하시오.
고객 불만 : 고객이 불만을 제기한 경우, 불만 내용을 기재한다. (없으면 기재 x)
"""

# 상담사 메시지 분석 프롬프트
# 역할: 상담사 발화 내용을 분석하여 응대 내용 요약
# 입력: query (상담사 발화 텍스트)
# 출력: 상담사 응대 내용 요약 (30자 이내 1문장)
REPRESENTATIVE_PROMPT = """
다음 상담사 발화 내용을 분석하여 ** 출력 형식 **에 맞춰 작성하시오.
※ 반드시 **30자 이내로 1문장**으로 작성하시오.
※ 반드시 한국어로 작성하시오.
※ 추가적인 설명, 부연 설명, 주석 등을 포함하지 않을 것.
※ 상담사의 대응, 문제 탐색, 전산 접수 내용을 포함하시오.

** 상담사 발화 내용 **: {query}\n\n

** 출력 형식 **\n
상담사 응대 :
"""

# 상품명 및 고객 감정 분석 프롬프트
# 역할: 대화에서 언급된 제품명과 고객의 감정 상태 추출
# 입력: query (대화 텍스트)
# 출력: 제품명과 고객 감정 점수(0-10)
ETC_PROMPT = """고객 문의 내용을 보고 제품명과 고객 감정 상태를 분석하시오\n
고객 문의 내용: {query}\n\n

** 출력 형식 **\n
제품명 : (상담 내용에 명시된 제품명을 그대로 추출)
고객 감정 : (0~10 사이의 숫자)

※ 고객 감정 점수 기준:
- 0~2: 매우 부정적 (강한 불만, 화난 상태)
- 3~4: 부정적 (불만)
- 5: 중립
- 6~7: 긍정적 (만족)
- 8~10: 매우 긍정적 (매우 만족, 감사)

※ 반드시 출력 형식에 맞춰 제품명과 고객 감정 점수만 기재하시오.
※ 상담 내용에 제품명(브랜드 네임 및 규격 포함)을 그대로 추출하시오
※ 제품명이 명확히 언급되지 않은 경우에만 관련 명사(예: 냉장고, 토마토 등)를 기재하시오.
※ 고객 감정은 반드시 0~10 사이의 숫자로만 표현하시오.
※ 특별한 감정표현이 없는 경우 5로 기재하시오.
"""

# Intent 선택 프롬프트
# 역할: 고객 문의에 가장 적합한 인텐트 선택
# 입력: options (선택 가능한 인텐트 목록)
# 출력: 선택된 하나의 인텐트
INTENT_PROMPT = """당신은 쿠팡 CS 어시스턴트입니다.\n
고객 문의에 대한 Intent를 다음 중에서 1개만 선택해야함.\n

선택 가능한 옵션:\n
{options}\n

반드시 다음과 같은 형식으로만 답변하세요:\n

=== 선택 결과 ===\n
intent: [선택한 옵션]\n
\n
주의사항:\n
1. 반드시 선택 결과 형식을 지켜서 답변해야함\n
2. 선택 가능한 옵션 중에서 가장 유사한 1개만 **선택**해야 함, \n
3. **중요** 절대 추가 설명이나 다른 내용을 포함하지 말아야하고 단답형으로 답변"""

# Entity 및 Utterance 분석 프롬프트
# 역할: 고객 문의에서 주요 엔티티와 핵심 발화 추출
# 입력: query (고객 문의 텍스트), intent3 (3단계 인텐트), intent4 (4단계 인텐트)
# 출력: JSON 형식의 Entity(핵심 명사), Utterance(고객 의도가 담긴 문장들)
ENTITY_UTTERANCE_PROMPT = """
아래 고객 문의와 추가 Intent 정보를 참고하여, 아래 항목에 해당하는 정보를 추출함. 반드시 **출력 예시** 형식으로 응답할 것.\n

고객 문의: {query}\n
추가 Intent 정보: {intent3}, {intent4}\n\n

[추출 항목 및 작업 규칙]\n
"Entity": 고객 문의 발화에 사용된 구성요소(예: 상품 정보, 파손 형태, 요청사항 등)를 고객이 실제 사용한 명사로 도출할 것.\n
"Utterance":
1) **고객 문의**와 **추가 Intent 정보**를 보고 고객 의도가 들어간 문장을 **원문 그대로** 추출할 것(가장 핵심이 되는 문장 2~3개 정도 추출)
2) 고객 발화 시점 순서대로 정리,
3) 문의 중 상품 언급이 있을 경우 해당 제품명을 포함할 것.

출력 예시:\n
{{
  "Entity": "예시,키워드",\n
  "Utterance": "["1) 고객 의도가 들어간 원문1", "2) 고객 의도가 들어간 원문2"]"
}}\n\n

주의사항:\n
- 응답은 JSON 형식으로 작성하되, 'Utterance' 필드는는 반드시 리스트 형식으로 출력해야함
- 'Utterance' 필드의 리스트 안의 각 내용은 1) 2) 3) 등으로 번호를 붙여 출력해야함
- JSON 객체의 모든 키와 값은 반드시 큰따옴표 (")로 감쌀 것.\n
- 추가적인 설명, 부연 설명, 주석 등을 포함하지 않을 것.
"""
```

## 고객 상담 내용

상담 대화 전문 데이터를 입력하여 모델에게 요약 요청

## 요구사항 반영 Prompt Engineering

- 대화 전문에서 고객, 상담사의 대화를 구분
- 고객의 대화에서 요구사항(request) 추출
- 생활어로 표현된 요구사항을 특정 단어로 교체

### 1. 프롬프트 설계의 핵심 요소

효과적인 프롬프트를 설계하기 위해 다음 네 가지 요소를 고려해야 합니다:

- 명확한 지시사항(Instruction): 모델이 수행해야 할 작업을 구체적으로 설명합니다.​
- 맥락(Context): 모델이 이해해야 할 배경 정보나 상황을 제공합니다.​
- 입력 데이터(Input Data): 모델이 처리해야 할 실제 데이터를 포함합니다.​
- 출력 형식(Output Format): 모델이 생성해야 할 결과의 형식이나 구조를 명시합니다.

이러한 요소들을 포함한 프롬프트는 모델이 요구사항을 정확히 이해하고 원하는 형태로 데이터를 정리하는 데 도움이 됩니다.

### 2. 효과적인 프롬프트 엔지니어링 전략

#### a. 역할 부여(Priming)

모델에게 특정 역할을 부여하여 응답의 방향성을 조정합니다. 예:​

"당신은 데이터 분석 전문가입니다. 아래 텍스트에서 주요 통계를 추출하여 표로 정리해주세요."​

이러한 접근은 모델이 특정 관점에서 정보를 처리하도록 유도합니다 .​

b. 예시 제공(Few-shot Learning)
모델에게 입력과 출력의 예시를 제공하여 원하는 응답 형식을 학습시킵니다. 예:​

입력: "제품 리뷰: 이 제품은 정말 훌륭합니다."​
LeewayHertz - AI Development Company

출력: "감정: 긍정적"​

이러한 예시를 통해 모델은 유사한 입력에 대해 일관된 출력을 생성할 수 있습니다 .​

c. 체인 오브 쏘트(Chain of Thought)
복잡한 문제를 단계별로 해결하도록 모델을 유도합니다. 예:​

"다음 수학 문제를 단계별로 해결해주세요: 12 + 23 × 2"​

이 방법은 모델이 중간 과정을 명시적으로 표현하게 하여 정확성을 높입니다 .​

d. 출력 형식 명시
모델이 생성해야 할 출력의 형식을 명확히 지정합니다. 예:​

"다음 정보를 JSON 형식으로 정리해주세요: 이름, 나이, 직업."​

이러한 명시는 모델이 일관된 구조로 출력을 생성하는 데 도움이 됩니다 .​

#### 3. 프롬프트 엔지니어링 프로세스

요구사항 분석: 추출하려는 데이터의 유형과 형식을 명확히 정의합니다.​

프롬프트 초안 작성: 위에서 언급한 전략을 활용하여 초기 프롬프트를 작성합니다.​
Brunch Story

테스트 및 수정: 모델의 응답을 검토하고, 필요에 따라 프롬프트를 수정합니다.​

반복 최적화: 여러 번의 반복을 통해 프롬프트의 효과를 극대화합니다.​

#### 4. 예시 프롬프트

"당신은 의료 데이터 분석가입니다. 아래 환자 기록에서 주요 증상과 진단명을 추출하여 JSON 형식으로 정리해주세요. 예시: {'증상': ['기침', '발열'], '진단': '폐렴'}"​

#### 5. 추가 고려사항

에러 핸들링: 모델이 예상치 못한 입력에 대해 어떻게 반응해야 하는지 명시합니다.​

출력 검증: 모델의 출력을 검토하여 정확성과 일관성을 확인합니다.​

도메인 특화: 특정 분야의 용어나 형식을 반영하여 프롬프트를 조정합니다.

## Prompt Engineering 기법

### Meta Prompting

- LLM 모델과의 교류에서 내용보다는 형식과 구조에 집중하는 방법
- 구조가 체계적으로 정리, 순차적 구성
- 정해진 양식으로 구성되어 단계별 구분
- 문제 해결이나 계획 세우기에 적합
- 적용 방식 :
  - 적용할 문제 선정
  - 문제 해결을 위한 단계 선정
  - 단계에 대한 답변 요구

### Generated Knowledge Prompting

- 지식 생성 기반 프롬프팅: 모델의 추론 능력을 강화
- 지식 생성, 지식 조직, 추론 과정의 구성
- 복잡한 추론에서 효과적

#### 설계 전략

1. 지식 생성 단계 최적화(단계별 지식 생성 프롬프트): 단계로 구성해 지식 생성 요청
2. 지식 통합 및 검증(지식 검증 프롬프트): 신뢰성, 관련성, 충분성을 검증
3. 답변 생성 및 정교화(답변 구조화 프롬프트): 핵심 답변, 근거, 예시 및 사례, 한계점 및 주의 사항
